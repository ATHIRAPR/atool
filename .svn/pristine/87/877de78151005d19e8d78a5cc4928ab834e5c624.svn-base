<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<!-- Meta -->
		{include file="page_meta.tpl.html"}
		<!-- /Meta -->
		<link rel="stylesheet" type="text/css" href="css/default.css" media="screen,print" />
		<title>文書ファイル管理ツール</title>

		<script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>
		<script src="js/jquery.tablesorter.js" type="text/javascript"></script>
		<script src="js/jquery.tablesorter.pager.js" type="text/javascript"></script>
		<script type="text/javascript" src="js/publish_table_sorter.js"></script>

		<script language="javascript">
			function show_edit_publish(id) {
				var form = document.edit_publish_form;
				form.action = "edit_publish.php";
				form.id.value = id;
				form.submit();
			}

			$(function() {
				$("[name='toggle_checkbox_all']").click(function() {
					var count = $("[name='toggle_checkbox_all']:checked").length;
					if (count > 0) {
						$("[name='sync_publish_id[]']").prop("checked", true);
					} else {
						$("[name='sync_publish_id[]']").prop("checked", false);
					}
					publish_config_check();
				});
				$(".first, .prev, .next, .last").click(function() {
					publish_config_check();
				});
			});

			function publish_config_check() {
				var count = $("[name='sync_publish_id[]']:checked").length;
				if (count > 0) {
					$("[name='show_publish_config']").prop("disabled", false);
				} else {
					$("[name='show_publish_config']").prop("disabled", true);
				}
			}

		</script>

	</head>

	<body>

		<div id="skip_link_block">
			<ul>
				<li>
					<a href="#main_content_anc">本文へジャンプします</a>
				</li>

			</ul>
			<p id="pageTop">
				ページの先頭です
			</p>
		</div>

		<div id="contents">

			<!-- Header Area -->
			{include file="page_header.tpl.html"}
			<!-- /Header Area -->

			<!-- Contents Area -->
			<div id="contents_body" class="clearfix">

				<!-- Left Navi Area -->
				{include file="left_menu.tpl.html" role_info=$role_info func_info=$func_info}
				<!-- /Left Navi Area -->

				<!-- Main Contents Area -->
				<div id="main_content_area">

					<div id="skip_main_block">
						<p id="main_content_anc">
							<a name="main_content_anc">本文の始まりです</a>
						</p>
					</div>

					<h2><em>公開管理</em></h2>

					<!-- 検索条件入力 -->
					<div class="task_select">
						<form name="search_publish" method="post">
							<table>
								<tr>
									<td>
									<div>
										文書種別
									</div></td>
									<td>
									<select name="doctype_id" style="width:200px; margin-right:10px;">
										{html_options options=$doctype_options selected=$doctype_id}
									</select></td>
									<td>
									<div>
										ファイル名
									</div></td>
									<td>
									<input type="text" name="file_nm" id="file_nm" style="width:200px;" value="{$file_nm|escape}" maxlength="250" />
									</td>
								</tr>
								<tr>
									<td>
									<div>
										タイトル
									</div></td>
									<td colspan="3">
									<input type="text" name="product_nm" id="product_nm" style="width:560px;"  value="{$product_nm|escape}" maxlength="500" />
									</td>
								</tr>
								<tr>
									<td>
									<div>
										型番
									</div></td>
									<td colspan="3">
									<input type="text" name="model_nm" id="model_nm" style="width:560px;" value="{$model_nm|escape}" maxlength="500" />
									</td>
								</tr>
								<tr>
									<td>
									<div>
										現在の状態
									</div></td>
									<td>
									<select name="status_flg" style="width:200px;">
										{html_options options=$status_options selected=$status_flg}
									</select></td>

									<td>
									<div>
										変更ファイル
									</div></td>
									<td><label for="show_sync_target_only">
										<input class="check_input" type="checkbox" name="show_sync_target_only" id="show_sync_target_only" value="1" {if $show_sync_target_only == 1}checked{/if}>
										変更作業をしたファイルを表示</label></td>
								</tr>
								<tr>
									<td>
									<div>
										反映後の状態
									</div></td>
									<td>
									<select name="edit_status_flg" style="width:200px;">
										{html_options options=$edit_status_options selected=$edit_status_flg}
									</select></td>

									<td>&nbsp;</td>
									<td align="right">
									<input type="image" src="image/btn_search2.jpg" name="button" id="button" value="一覧表示" onclick="javascript:document.search_publish.submit(); return false;" />
									<input type="image" alt="条件をクリアする" src="image/btn_clear.jpg" onclick="window.location.href='manage_publish.php'; return false;">
									</td>
								</tr>
							</table>
						</form>
					</div>

					<form name="sync_publish_form" action="sync_publish.php" method="post">

						<div class="open_area clearfix">
							<p>
								<input type="image" src="image/btn_open.jpg" name="button" id="button" value="チェックした項目を公開する" onclick="return confirm('公開処理を行います');" />
							</p>
						</div>
						<br>

						<!-- ページ送り  -->
						{include file='table_pager.tpl.html'}
						<!-- /ページ送り  -->

						<!-- ソート　テーブル -->
						<table id="publish_table_sorter" class="tablesorter">
							<thead>
								<tr>
									<th class="bg_col_gr" width="55">ファイル</th>
									<th class="bg_col_gr" width="55">文書種別</th>
									<th class="bg_col_gr" width="100">タイトル</th>
									<th class="bg_col_bl">変更内容</th>
									<th class="bg_col_bl">公開日</th>
									<th class="bg_col_bl">販売終了日</th>
									<th class="bg_col_bl">現在</th>
									<th class="bg_col_bl">反映後</th>
									<th class="bg_col_bl">更新者</th>
									<td align="center" style="background-color: #878787; color: #ffffff; padding: 3px 5px;">
									<input type="checkbox" name="toggle_checkbox_all">
									</td>
								</tr>
							</thead>

							<tbody>
								{foreach from=$list item=data}
								{assign var='color_gray' value=''}

								{if !isset($data.edit_update_dt)}
								<tr class="bg_col_lgy">
									{else}
									<tr>
										{/if}

										<td><a href="edit_file.php?id={$data.id}">{$data.file_nm|escape|replace:',':'
										<br>
										'}</a></td>
										<td nowrap>{$data.type_nm|escape|replace:'\n':'
										<br>
										'}</td>
										<td>{$data.product_nm|escape}</td>
										<td>{$data.modified|escape}</td>
										{if isset($data.edit_publish_start_dt) }
										<td>{$data.edit_publish_start_dt|escape|date_format:"%Y/%m/%d"}</td>
										{else}
										<td>{$data.publish_start_dt|escape|date_format:"%Y/%m/%d"}</td>
										{/if}

										{if isset($data.edit_sale_end_dt) }
										<td>{$data.edit_sale_end_dt|escape|date_format:"%Y/%m/%d"}</td>
										{else}
										<td>{$data.sale_end_dt|escape|date_format:"%Y/%m/%d"}</td>
										{/if}
										<td align="center"> {if $data.status_flg == 1}
										{if $data.publish_start_dt|strtotime < $smarty.now}
										<div class="open">
											公開
										</div> {else}
										<div class="ready">
											公開
											<br>
											予定
										</div> {/if}
										{else}
										{if $data.publish_dt}
										<div class="close">
											非公開
										</div>{else}
										<div class="new">
											新規
										</div>{/if}
										{/if}
				</div>
				</td>
				<td align="center"> {if $data.edit_status_flg == 1}
				{if $data.edit_publish_start_dt|strtotime < $smarty.now}
				<div class="open">
					公開{*(PDF)*}
				</div> {else}
				<div class="ready">
					公開
					<br>
					予定
				</div> {/if}
				{elseif $data.edit_status_flg == 2}
				<div class="open">
					公開{*(PDF/キーワード)*}
				</div> {elseif isset($data.edit_status_flg)}{if $data.edit_status_flg == 0}
				<div class="close">
					非公開
				</div>{/if}{/if}
			</div>
			</td>
			<td>{$data.edit_update_login_nm|escape|regex_replace:"/\@.*$/":""}</td>

			<td class="center" > {if isset($data.edit_update_dt)}
			<input type="checkbox" name="sync_publish_id[]" value="{$data.id|escape}" onclick="javascript:publish_config_check()">
			</input>{/if} </td>
			</tr>

			{foreachelse}

			{/foreach}
			</tbody>

			</table>
			<!-- /ソート　テーブル -->
			</form>

			<form name="edit_publish_form" method="get">
				<input type="hidden" name="id" />
			</form>

			<div id="skip_end_block">
				<p id="pageEnd">
					本文の終わりです。
				</p>
			</div>

			<p class="goto_pagetop">
				<a href="#header"><img src="../image/common/btnPagetop.gif" alt="ページの先頭へ" /></a>
			</p>

		</div>
		<!-- /Main Contents Area -->

		</div>
		<!-- /Contents Area -->

		<!-- Footer Area -->
		{include file="page_footer.tpl.html"}
		<!-- /Footer Area -->

		</div>
	</body>
</html>

